#
#
#

ARG DISTRIBUTION=ubuntu
ARG CODENAME=bionic

FROM $DISTRIBUTION:$CODENAME

ARG DISTRIBUTION
ARG CODENAME

MAINTAINER Rodrigo Cabral <rodrixcornell@gmail.com.br>

ENV DEBIAN_FRONTEND noninteractive
ENV LANG=pt_BR.utf8
ENV LANGUAGE=pt_BR:pt
ENV PHP_VERSION 7.2
ENV NODE_VERSION 11
ENV ORACLE_INSTANTCLIENT 11.2
ENV ORACLE_BASE /usr/lib/oracle
ENV ORACLE_HOME $ORACLE_BASE/$ORACLE_INSTANTCLIENT/client64
ENV LD_LIBRARY_PATH $ORACLE_HOME/lib

ENV NLS_TERRITORY BRAZIL
ENV NLS_LANG BRAZILIAN PORTUGUESE_BRAZIL.UTF8
ENV NLS_LANGUAGE BRAZILIAN PORTUGUESE
ENV NLS_CHARACTERSET UTF8
ENV NLS_NCHAR_CHARACTERSET AL32UTF8
ENV NLS_CURRENCY R$
ENV NLS_NUMERIC_CHARACTERS .,
ENV NLS_SORT WEST_EUROPEAN_AI
ENV NLS_COMP BINARY
ENV NLS_DATE_FORMAT RRRR-MM-DD HH24:MI:SS
ENV NLS_TIMESTAMP_FORMAT RRRR-MM-DD HH24:MI:SS.FF

ADD oracle-instantclient$ORACLE_INSTANTCLIENT* /tmp/
ADD install.sh /tmp/

RUN ["/bin/bash", "-c", ". /tmp/install.sh && rm -rf /tmp/install.sh"]

##<autogenerated>##
# Configurações do php-fpm
RUN set -ex \
&& cd /etc/php/$PHP_VERSION/fpm/ \
&& cp -rf php-fpm.conf php-fpm.conf.default \
&& cp -rf pool.d/www.conf pool.d/www.conf.default \
&& if [ -d php-fpm.d ]; then \
# for some reason, upstream's php-fpm.conf.default has "include=NONE/etc/php-fpm.d/*.conf"
sed "s!=NONE/!=!g" php-fpm.conf.default | tee php-fpm.conf > /dev/null; \
cp php-fpm.d/www.conf.default php-fpm.d/www.conf; \
else \
# PHP 5.x doesn't use "include=" by default, so we'll create our own simple config that mimics PHP 7+ for consistency
mkdir php-fpm.d; \
cp php-fpm.conf.default php-fpm.d/www.conf; \
{ \
echo "[global]"; \
echo "include=/etc/php/$PHP_VERSION/fpm/php-fpm.d/*.conf"; \
} | tee php-fpm.conf; \
fi \
&& { \
echo "[global]"; \
echo "error_log = /proc/self/fd/2"; \
echo; \
echo "[www]"; \
echo "; if we send this to /proc/self/fd/1, it never appears"; \
echo "access.log = /proc/self/fd/2"; \
echo; \
echo "clear_env = no"; \
echo; \
echo "; Ensure worker stdout and stderr are sent to the main error log."; \
echo "catch_workers_output = yes"; \
} | tee php-fpm.d/docker.conf \
&& { \
echo "[global]"; \
echo "daemonize = no"; \
echo; \
echo "[www]"; \
echo "listen = 9000"; \
} | tee php-fpm.d/zz-docker.conf \
&& /etc/init.d/php$PHP_VERSION-fpm start && /etc/init.d/php$PHP_VERSION-fpm status \
&& cd /usr/sbin && ln -sfv php-fpm$PHP_VERSION php-fpm

EXPOSE 9000
WORKDIR /var/www
CMD ["php-fpm"]
##</autogenerated>##
