#
#
#

ARG DISTRIBUTION=ubuntu
ARG CODENAME=bionic

FROM $DISTRIBUTION:$CODENAME

ARG DISTRIBUTION
ARG CODENAME

MAINTAINER Rodrigo Cabral <rodrixcornell@gmail.com.br>

ENV DEBIAN_FRONTEND noninteractive
ENV LANG=pt_BR.utf8
ENV LANGUAGE=pt_BR:pt
ENV PHP_VERSION 7.3
ENV ORACLE_INSTANTCLIENT 11.2
ENV ORACLE_BASE /usr/lib/oracle
ENV ORACLE_HOME $ORACLE_BASE/$ORACLE_INSTANTCLIENT/client64
ENV LD_LIBRARY_PATH $ORACLE_HOME/lib

ENV NLS_TERRITORY BRAZIL
ENV NLS_LANG BRAZILIAN PORTUGUESE_BRAZIL.UTF8
ENV NLS_LANGUAGE BRAZILIAN PORTUGUESE
ENV NLS_CHARACTERSET UTF8
ENV NLS_NCHAR_CHARACTERSET AL32UTF8
ENV NLS_CURRENCY R$
ENV NLS_NUMERIC_CHARACTERS .,
ENV NLS_SORT WEST_EUROPEAN_AI
ENV NLS_COMP BINARY
ENV NLS_DATE_FORMAT RRRR-MM-DD HH24:MI:SS
ENV NLS_TIMESTAMP_FORMAT RRRR-MM-DD HH24:MI:SS.FF

ADD oracle-instantclient$ORACLE_INSTANTCLIENT* /tmp/
ADD install.sh /tmp/

RUN ["/bin/bash", "-c", ". /tmp/install.sh && rm -rf /tmp/install.sh"]

##<autogenerated>##
ENV APACHE_CONFDIR=/etc/apache2
ENV APACHE_ENVVARS=$APACHE_CONFDIR/envvars

ADD apache2-foreground /usr/local/bin/

RUN set -eux; \
chmod +x /usr/local/bin/apache2-foreground; \
cp -rf $APACHE_CONFDIR/envvars $APACHE_CONFDIR/envvars.default; \
\
# generically convert lines like
#   export APACHE_RUN_USER=www-data
# into
#   : ${APACHE_RUN_USER:=www-data}
#   export APACHE_RUN_USER
# so that they can be overridden at runtime ("-e APACHE_RUN_USER=...")
sed -ri 's/^export ([^=]+)=(.*)$/: ${\1:=\2}\nexport \1/' "$APACHE_ENVVARS"; \
\
# setup directories and permissions
. "$APACHE_ENVVARS"; \
for dir in \
"$APACHE_LOCK_DIR" \
"$APACHE_RUN_DIR" \
"$APACHE_LOG_DIR" \
/var/www/html \
; do \
rm -rvf "$dir"; \
mkdir -p "$dir"; \
chown "$APACHE_RUN_USER:$APACHE_RUN_GROUP" "$dir"; \
# allow running as an arbitrary user (https://github.com/docker-library/php/issues/743)
chmod 777 "$dir"; \
done; \
\
# logs should go to stdout / stderr
ln -sfT /dev/stderr "$APACHE_LOG_DIR/error.log"; \
ln -sfT /dev/stdout "$APACHE_LOG_DIR/access.log"; \
ln -sfT /dev/stdout "$APACHE_LOG_DIR/other_vhosts_access.log"; \
chown -R --no-dereference "$APACHE_RUN_USER:$APACHE_RUN_GROUP" "$APACHE_LOG_DIR"; \
\
# PHP files should be handled by PHP, and should be preferred over any other file type
{ \
echo "<FilesMatch \.php$>"; \
echo "    SetHandler application/x-httpd-php"; \
echo "</FilesMatch>"; \
echo; \
echo "DirectoryIndex disabled"; \
echo "DirectoryIndex index.php index.html"; \
echo; \
echo "<Directory /var/www/>"; \
echo "    Options -Indexes"; \
echo "    AllowOverride All"; \
echo "</Directory>"; \
} | tee "$APACHE_CONFDIR/conf-available/docker-php.conf"; \
a2enconf docker-php; \
/etc/init.d/apache2 restart; /etc/init.d/apache2 status
##</autogenerated>##

##<autogenerated>##
WORKDIR /var/www/html

EXPOSE 80
CMD ["apache2-foreground"]
##</autogenerated>##
